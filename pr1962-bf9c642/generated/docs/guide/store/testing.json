{
  "id": "guide/store/testing",
  "title": "Testing",
  "contents": "\n\n\n  <div class=\"github-links\">\n    <a href=\"https://github.com/ngrx/platform/edit/master/projects/ngrx.io/content/guide/store/testing.md?message=docs%3A%20describe%20your%20change...\" aria-label=\"Suggest Edits\" title=\"Suggest Edits\"><i class=\"material-icons\" aria-hidden=\"true\" role=\"img\">mode_edit</i></a>\n  </div>\n\n\n<div class=\"content\">\n<h1 id=\"testing\">Testing<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/store/testing#testing\"><i class=\"material-icons\">link</i></a></h1>\n<h3 id=\"using-a-mock-store\">Using a Mock Store<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/store/testing#using-a-mock-store\"><i class=\"material-icons\">link</i></a></h3>\n<p>The <code><a href=\"api/store/testing/provideMockStore\" class=\"code-anchor\">provideMockStore</a>()</code> function registers providers that allow you to mock out the <code><a href=\"api/store/Store\" class=\"code-anchor\">Store</a></code> for testing functionality that has a dependency on <code><a href=\"api/store/Store\" class=\"code-anchor\">Store</a></code> without setting up reducers.\nYou can write tests validating behaviors corresponding to the specific state snapshot easily.</p>\n<div class=\"alert is-helpful\">\n<p><strong>Note:</strong> All dispatched actions don't affect to the state, but you can see them in the <code><a href=\"api/effects/Actions\" class=\"code-anchor\">Actions</a></code> stream.</p>\n</div>\n<p>Usage: </p>\n<code-example header=\"auth.guard.spec.ts\">\nimport { TestBed } from '@angular/core/testing';\nimport { <a href=\"api/store/Store\" class=\"code-anchor\">Store</a> } from '@ngrx/store';\nimport { <a href=\"api/store/testing/provideMockStore\" class=\"code-anchor\">provideMockStore</a> } from '@ngrx/store/testing';\nimport { cold } from 'jasmine-marbles';\n\nimport { AuthGuard } from '../guards/auth.guard';\n\ndescribe('Auth Guard', () => {\n  let guard: AuthGuard;\n  let store: <a href=\"api/store/testing/MockStore\" class=\"code-anchor\">MockStore</a>&#x3C;{ loggedIn: boolean }>;\n  const initialState = { loggedIn: false };\n\n  beforeEach(() => {\n    TestBed.configureTestingModule({\n      imports: [\n        // any modules needed\n      ],\n      providers: [\n        AuthGuard,\n        <a href=\"api/store/testing/provideMockStore\" class=\"code-anchor\">provideMockStore</a>({ initialState }),\n        // other providers\n      ],\n    });\n\n    guard = TestBed.get(AuthGuard);\n    store = TestBed.get(<a href=\"api/store/Store\" class=\"code-anchor\">Store</a>);\n  });\n\n  it('should return false if the user <a href=\"api/store-devtools/StoreDevtools#state\" class=\"code-anchor\">state</a> is not logged in', () => {\n    const expected = cold('(a|)', { a: false });\n\n    expect(guard.canActivate()).toBeObservable(expected);\n  });\n\n  it('should return true if the user <a href=\"api/store-devtools/StoreDevtools#state\" class=\"code-anchor\">state</a> is logged in', () => {\n    store.setState({ loggedIn: true });\n\n    const expected = cold('(a|)', { a: true });\n\n    expect(guard.canActivate()).toBeObservable(expected);\n  });\n});\n</code-example>\n<h3 id=\"using-mock-selectors\">Using Mock Selectors<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/store/testing#using-mock-selectors\"><i class=\"material-icons\">link</i></a></h3>\n<p><code><a href=\"api/store/testing/MockStore\" class=\"code-anchor\">MockStore</a></code> also provides the ability to mock individual selectors to return a passed value using the <code><a href=\"\" class=\"code-anchor\">overrideSelector()</a></code> method. When the selector is invoked by the <code><a href=\"api/store/select\" class=\"code-anchor\">select</a></code> method, the returned value is overridden by the passed value, regardless of the current state in the store. </p>\n<p><code><a href=\"\" class=\"code-anchor\">overrideSelector()</a></code> returns a <code><a href=\"api/store/MemoizedSelector\" class=\"code-anchor\">MemoizedSelector</a></code>. To update the mock selector to return a different value, use the <code><a href=\"api/store/MemoizedSelector\" class=\"code-anchor\">MemoizedSelector</a></code>'s <code>setResult()</code> method.</p>\n<p><code><a href=\"\" class=\"code-anchor\">overrideSelector()</a></code> supports mocking the <code><a href=\"api/store/select\" class=\"code-anchor\">select</a></code> method (used in RxJS pipe) and the <code><a href=\"api/store/Store\" class=\"code-anchor\">Store</a></code> <code><a href=\"api/store/select\" class=\"code-anchor\">select</a></code> instance method using a string or selector.</p>\n<p>Usage:</p>\n<code-example header=\"auth-guard.service.ts\" path=\"testing-store/src/app/auth-guard.service.ts\">\nimport { Injectable } from '@angular/core';\nimport { CanActivate } from '@angular/router';\nimport { <a href=\"api/store/Store\" class=\"code-anchor\">Store</a>, <a href=\"api/store/select\" class=\"code-anchor\">select</a> } from '@ngrx/store';\nimport { take } from 'rxjs/operators';\nimport * as fromAuth from './reducers';\n\n@Injectable({\n  providedIn: 'root',\n})\nexport class AuthGuard implements CanActivate {\n  constructor(private store: <a href=\"api/store/Store\" class=\"code-anchor\">Store</a>&#x3C;fromAuth.State>) {}\n\n  canActivate() {\n    return this.store.pipe(\n      <a href=\"api/store/select\" class=\"code-anchor\">select</a>(fromAuth.getLoggedIn),\n      take(1)\n    );\n  }\n}\n\n</code-example>\n<code-example header=\"auth-guard.service.spec.ts\" path=\"testing-store/src/app/auth-guard.service.spec.ts\">\nimport { TestBed } from '@angular/core/testing';\nimport { <a href=\"api/store/Store\" class=\"code-anchor\">Store</a>, <a href=\"api/store/MemoizedSelector\" class=\"code-anchor\">MemoizedSelector</a> } from '@ngrx/store';\nimport { <a href=\"api/store/testing/provideMockStore\" class=\"code-anchor\">provideMockStore</a>, <a href=\"api/store/testing/MockStore\" class=\"code-anchor\">MockStore</a> } from '@ngrx/store/testing';\nimport { cold } from 'jasmine-marbles';\nimport { AuthGuard } from './auth-guard.service';\nimport * as fromAuth from './reducers';\n\ndescribe('Auth Guard', () => {\n  let guard: AuthGuard;\n  let store: <a href=\"api/store/testing/MockStore\" class=\"code-anchor\">MockStore</a>&#x3C;fromAuth.State>;\n  let loggedIn: <a href=\"api/store/MemoizedSelector\" class=\"code-anchor\">MemoizedSelector</a>&#x3C;fromAuth.State, boolean>;\n\n  beforeEach(() => {\n    TestBed.configureTestingModule({\n      providers: [AuthGuard, <a href=\"api/store/testing/provideMockStore\" class=\"code-anchor\">provideMockStore</a>()],\n    });\n\n    store = TestBed.get(<a href=\"api/store/Store\" class=\"code-anchor\">Store</a>);\n    guard = TestBed.get(AuthGuard);\n\n    loggedIn = store.overrideSelector(fromAuth.getLoggedIn, false);\n  });\n\n  it('should return false if the user <a href=\"api/store-devtools/StoreDevtools#state\" class=\"code-anchor\">state</a> is not logged in', () => {\n    const expected = cold('(a|)', { a: false });\n\n    expect(guard.canActivate()).toBeObservable(expected);\n  });\n\n  it('should return true if the user <a href=\"api/store-devtools/StoreDevtools#state\" class=\"code-anchor\">state</a> is logged in', () => {\n    const expected = cold('(a|)', { a: true });\n\n    loggedIn.setResult(true);\n\n    expect(guard.canActivate()).toBeObservable(expected);\n  });\n});\n\n</code-example>\n<p>In this example, we mock the <code>getLoggedIn</code> selector by using <code>overrideSelector</code>, passing in the <code>getLoggedIn</code> selector with a default mocked return value of <code>false</code>.  In the second test, we use <code>setResult()</code> to update the mock selector to return <code>true</code>.</p>\n<p>Try the <live-example name=\"testing-store\"></live-example>.</p>\n<h3 id=\"integration-testing\">Integration Testing<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/store/testing#integration-testing\"><i class=\"material-icons\">link</i></a></h3>\n<p>An integration test should verify that the <code><a href=\"api/store/Store\" class=\"code-anchor\">Store</a></code> coherently works together with our components and services that inject <code><a href=\"api/store/Store\" class=\"code-anchor\">Store</a></code>.  An integration test will not mock the store or individual selectors, as unit tests do, but will instead integrate a <code><a href=\"api/store/Store\" class=\"code-anchor\">Store</a></code> by using <code>StoreModule.forRoot</code> in your <code>TestBed</code> configuration.</p>\n<code-example header=\"counter.component.ts\">\nimport { Component } from '@angular/core';\nimport { <a href=\"api/store/Store\" class=\"code-anchor\">Store</a> } from '@ngrx/store';\nimport { CounterActions } from '../actions';\nimport * as fromCount from '../reducers';\n\n@Component({\n  <a href=\"api/store/testing/MockSelector#selector\" class=\"code-anchor\">selector</a>: 'app-counter',\n  template: `\n    &#x3C;p>{{ count$ | async }}&#x3C;/p>\n    &#x3C;button (click)=\"increment()\">Increment&#x3C;/button>\n  `\n})\nexport class CounterComponent {\n  count$ = this.store.select(fromCount.getCount);\n\n  constructor(private store: <a href=\"api/store/Store\" class=\"code-anchor\">Store</a>&#x3C;fromCount.State>) { }\n\n  increment() {\n    this.store.dispatch(CounterActions.increment());\n  }\n}\n</code-example>\n<p>This example component implements a simple counter which is displayed to the user.  It has an increment method which dispatches an increment action to the <code><a href=\"api/store/Store\" class=\"code-anchor\">Store</a></code>. A reducer increments the previous state's counter, then the selector emits the latest value to the component.</p>\n<code-example header=\"counter-integration.spec.ts\">\nimport { TestBed, async } from '@angular/core/testing';\nimport { <a href=\"api/store/StoreModule\" class=\"code-anchor\">StoreModule</a> } from '@ngrx/store';\nimport { CounterComponent } from '../counter/counter.component';\nimport { reducers } from '../reducers';\n\ndescribe('CounterComponent', () => {\n  let component: CounterComponent;\n\n  beforeEach(async(() => {\n    TestBed.configureTestingModule({\n      declarations: [\n        CounterComponent\n      ],\n      imports: [\n        StoreModule.forRoot(reducers)\n      ]\n    }).compileComponents();\n\n    const fixture = TestBed.createComponent(CounterComponent);\n    component = fixture.debugElement.componentInstance;\n    fixture.detectChanges();\n  }));\n\n  it('should create the component', () => {\n    expect(component).toBeTruthy();\n  });\n\n  it('should increment the counter <a href=\"api/store/testing/MockSelector#value\" class=\"code-anchor\">value</a> after increment is invoked', () => {\n    component.increment();\n    component.count$.subscribe(count =>\n      expect(count).toBe(1)\n    );\n  });\n});\n</code-example>\n<p>The integration test sets up the dependent <code><a href=\"api/store/Store\" class=\"code-anchor\">Store</a></code> by importing the <code><a href=\"api/store/StoreModule\" class=\"code-anchor\">StoreModule</a></code>. In this example, we verify that dispatching an increment action causes the state to be updated with an incremented counter value, which is correctly emitted by the selector.</p>\n<h3 id=\"testing-selectors\">Testing selectors<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/store/testing#testing-selectors\"><i class=\"material-icons\">link</i></a></h3>\n<p>You can use the projector function used by the selector by accessing the <code>.projector</code> property.</p>\n<code-example header=\"my.reducer.ts\">\nexport interface <a href=\"api/store/State\" class=\"code-anchor\">State</a> {\n  evenNums: number[];\n  oddNums: number[];\n}\n\nexport const selectSumEvenNums = <a href=\"api/store/createSelector\" class=\"code-anchor\">createSelector</a>(\n  (<a href=\"api/store-devtools/StoreDevtools#state\" class=\"code-anchor\">state</a>: <a href=\"api/store/State\" class=\"code-anchor\">State</a>) => state.evenNums,\n  evenNums => evenNums.reduce((prev, curr) => prev + curr)\n);\nexport const selectSumOddNums = <a href=\"api/store/createSelector\" class=\"code-anchor\">createSelector</a>(\n  (<a href=\"api/store-devtools/StoreDevtools#state\" class=\"code-anchor\">state</a>: <a href=\"api/store/State\" class=\"code-anchor\">State</a>) => state.oddNums,\n  oddNums => oddNums.reduce((prev, curr) => prev + curr)\n);\nexport const selectTotal = <a href=\"api/store/createSelector\" class=\"code-anchor\">createSelector</a>(\n  selectSumEvenNums,\n  selectSumOddNums,\n  (evenSum, oddSum) => evenSum + oddSum\n);\n</code-example>\n<code-example header=\"my.reducer.spec.ts\">\nimport * as fromMyReducers from './my-reducers';\n\ndescribe('My Selectors', () => {\n  it('should calc selectTotal', () => {\n    expect(fromMyReducers.selectTotal.projector(2, 3)).toBe(5);\n  });\n});\n</code-example>\n\n</div>\n\n<!-- links to this doc:\n-->\n<!-- links from this doc:\n - api/effects/Actions\n - api/store-devtools/StoreDevtools#state\n - api/store/MemoizedSelector\n - api/store/State\n - api/store/Store\n - api/store/StoreModule\n - api/store/createSelector\n - api/store/select\n - api/store/testing/MockSelector#selector\n - api/store/testing/MockSelector#value\n - api/store/testing/MockStore\n - api/store/testing/provideMockStore\n - guide/store/testing#integration-testing\n - guide/store/testing#testing\n - guide/store/testing#testing-selectors\n - guide/store/testing#using-a-mock-store\n - guide/store/testing#using-mock-selectors\n - https://github.com/ngrx/platform/edit/master/projects/ngrx.io/content/guide/store/testing.md?message=docs%3A%20describe%20your%20change...\n-->"
}