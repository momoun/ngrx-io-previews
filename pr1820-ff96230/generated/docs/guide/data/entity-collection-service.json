{
  "id": "guide/data/entity-collection-service",
  "title": "EntityCollectionService",
  "contents": "\n\n\n  <div class=\"github-links\">\n    <a href=\"https://github.com/ngrx/platform/edit/master/projects/ngrx.io/content/guide/data/entity-collection-service.md?message=docs%3A%20describe%20your%20change...\" aria-label=\"Suggest Edits\" title=\"Suggest Edits\"><i class=\"material-icons\" aria-hidden=\"true\" role=\"img\">mode_edit</i></a>\n  </div>\n\n\n<div class=\"content\">\n<h1 id=\"entitycollectionservice\">EntityCollectionService<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/data/entity-collection-service#entitycollectionservice\"><i class=\"material-icons\">link</i></a></h1>\n<p>An <strong><code><a href=\"api/data/EntityCollectionService\" class=\"code-anchor\">EntityCollectionService</a></code></strong> is a facade over the NgRx Data <strong>dispatcher</strong> and <strong>selectors$</strong> that manages an entity <code>T</code> collection cached in the <em>NgRx store</em>.</p>\n<p>The <strong><em>Dispatcher</em></strong> features <strong>command</strong> methods that dispatch <a href=\"guide/data/entity-actions\"><em>entity actions</em></a> to the <em>NgRx store</em>.\nThese commands either update the entity collection directly or trigger HTTP requests to a server. When the server responds, the NgRx Data library dispatches new actions with the response data and these actions update the entity collection.</p>\n<p>The <code><a href=\"api/data/EntityCommands\" class=\"code-anchor\">EntityCommands</a></code> interface lists all the commands and what they do.</p>\n<p>Your application calls these <em>command methods</em> to update\nthe <em>cached entity collection</em> in the <em>NgRx store</em>.</p>\n<p><strong><em>Selectors$</em></strong> are properties returning <em>selector observables</em>.\nEach <em>observable</em> watches for a specific change in the cached entity collection and emits the changed value.</p>\n<p>The <code><a href=\"api/data/EntitySelectors$\" class=\"code-anchor\">EntitySelectors$</a></code> interface lists all of the pre-defined <em>selector observable properties</em> and\nexplains which collection properties they observe.</p>\n<p>Your application subscribes to <em>selector observables</em>\nin order to process and display entities in the collection.</p>\n<h2 id=\"examples-from-the-demo-app\">Examples from the demo app<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/data/entity-collection-service#examples-from-the-demo-app\"><i class=\"material-icons\">link</i></a></h2>\n<p>Here are simplified excerpts from the demo app's <code>HeroesComponent</code> showing the component calling <em>command methods</em> and subscribing to <em>selector observables</em>.</p>\n<code-example language=\"typescript\">\nconstructor(<a href=\"api/data/EntityCollectionServiceFactory\" class=\"code-anchor\">EntityCollectionServiceFactory</a>: <a href=\"api/data/EntityCollectionServiceFactory\" class=\"code-anchor\">EntityCollectionServiceFactory</a>) {\n  this.heroService = EntityCollectionServiceFactory.create&#x3C;Hero>('Hero');\n  this.filteredHeroes$ = this.heroService.filteredEntities$;\n  this.loading$ = this.heroService.loading$;\n}\n\ngetHeroes() { this.heroService.getAll(); }\nadd(hero: Hero) { this.heroService.add(hero); }\ndeleteHero(hero: Hero) { this.heroService.delete(hero.id); }\nupdate(hero: Hero) { this.heroService.update(hero); }\n</code-example>\n<h3 id=\"create-the-entitycollectionservice-with-a-factory\">Create the <em>EntityCollectionService</em> with a factory<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/data/entity-collection-service#create-the-entitycollectionservice-with-a-factory\"><i class=\"material-icons\">link</i></a></h3>\n<p>The component injects the NgRx Data <code><a href=\"api/data/EntityCollectionServiceFactory\" class=\"code-anchor\">EntityCollectionServiceFactory</a></code> and\ncreates an <code><a href=\"api/data/EntityCollectionService\" class=\"code-anchor\">EntityCollectionService</a></code> for <code>Hero</code> entities.</p>\n<blockquote>\n<p>We'll go inside the factory <a href=\"guide/data/entity-collection-service#entity-collection-service-factory\">later in this guide</a>.</p>\n</blockquote>\n<h3 id=\"create-the-entitycollectionservice-as-a-class\">Create the <em>EntityCollectionService</em> as a class<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/data/entity-collection-service#create-the-entitycollectionservice-as-a-class\"><i class=\"material-icons\">link</i></a></h3>\n<p>Alternatively, you could have created a single <code>HeroEntityService</code> elsewhere, perhaps in the <code>AppModule</code>, and injected it into the component's constructor.</p>\n<p>There are two basic ways to create the service class.</p>\n<ol>\n<li>Derive from <code><a href=\"api/data/EntityCollectionServiceBase\" class=\"code-anchor\">EntityCollectionServiceBase</a>&#x3C;T></code></li>\n<li>Write a <code>HeroEntityService</code> with just the API you need.</li>\n</ol>\n<p>When <code>HeroEntityService</code> derives from <code><a href=\"api/data/EntityCollectionServiceBase\" class=\"code-anchor\">EntityCollectionServiceBase</a>&#x3C;T></code> it must inject the <code><a href=\"api/data/EntityCollectionServiceFactory\" class=\"code-anchor\">EntityCollectionServiceFactory</a></code> into its constructor.\nThere are examples of this approach in the demo app.</p>\n<p>When defining an <code>HeroEntityService</code> with a limited API,\nyou may also inject <code><a href=\"api/data/EntityCollectionServiceFactory\" class=\"code-anchor\">EntityCollectionServiceFactory</a></code> as a source of the\nfunctionality that you choose to expose.</p>\n<p>Let your preferred style and app needs determine which creation technique you choose.</p>\n<h3 id=\"set-component-selector-properties\">Set component <em>selector$</em> properties<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/data/entity-collection-service#set-component-selector-properties\"><i class=\"material-icons\">link</i></a></h3>\n<p>The component sets two of its properties to two of the <code><a href=\"api/data/EntityCollectionService\" class=\"code-anchor\">EntityCollectionService</a></code> <em>selector observables</em>: <code>filteredEntities$</code> and <code><a href=\"api/data/EntityCollection#loading\" class=\"code-anchor\">loading</a>$</code>.</p>\n<p>The <code>filteredEntities$</code> <em>observable</em> produces an array of the currently cached <code>Hero</code> entities that satisfy the user's filter criteria.\nThis <em>observable</em> produces a new array of heroes if the user\nchanges the filter or if some action changes the heroes in the cached collection.</p>\n<p>The <code><a href=\"api/data/EntityCollection#loading\" class=\"code-anchor\">loading</a>$</code> <em>observable</em> produces <code>true</code> while the\n<a href=\"guide/data/entity-dataservice\">data service</a> is waiting for heroes from the server.\nIt produces <code>false</code> when the server responds.\nThe demo app subscribes to <code><a href=\"api/data/EntityCollection#loading\" class=\"code-anchor\">loading</a>$</code> so that it can turn a visual loading indicator on and off.</p>\n<p>Note that these component and <code><a href=\"api/data/EntityCollectionService\" class=\"code-anchor\">EntityCollectionService</a></code> selector property names end in <code>'$'</code>, a common convention for a property that returns an <code>Observable</code>.</p>\n<p>All <em>selector observable</em> properties of an <code><a href=\"api/data/EntityCollectionService\" class=\"code-anchor\">EntityCollectionService</a></code> follow this convention.\nFor brevity, we'll refer to them going forward as <em><code>selector$</code> properties</em> or <em><code>selectors$</code></em>.</p>\n<blockquote>\n<p>Note that these <em><code>selector$</code></em> properties (with an <code>'s'</code>) differ from the closely-related <code>selector</code> properties (no <code>'$'</code> suffix),\ndiscussed elsewhere.</p>\n<p>A <code>selector</code> property returns a <em>function</em> that selects from the entity collection.\nThat function is an ingredient in the production of values for its corresponding <code>selector$</code> property.</p>\n</blockquote>\n<p>The component <em>class</em> does not subscribe these <code>selector$</code> properties but the component <em>template</em> does.</p>\n<p>The template binds to them and forwards their <em>observables</em> to the Angular <code>AsyncPipe</code>, which subscribes to them.\nHere's an excerpt of the <code>filteredHeroes$</code> binding.</p>\n<code-example language=\"html\">\n&#x3C;div *ngIf=\"filteredHeroes$ | async as heroes\">\n...\n&#x3C;/div>\n</code-example>\n<h3 id=\"call-command-methods\">Call <em>command methods</em><a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/data/entity-collection-service#call-command-methods\"><i class=\"material-icons\">link</i></a></h3>\n<p>Most of the <code>HeroesComponent</code> methods delegate to <code><a href=\"api/data/EntityCollectionService\" class=\"code-anchor\">EntityCollectionService</a></code> command methods such as <code>getAll()</code> and <code>add()</code>.</p>\n<p>There are two kinds of commands:</p>\n<ol>\n<li>Commands that trigger requests to the server.</li>\n<li>Cache-only commands that update the cached entity collection.</li>\n</ol>\n<p>The server commands are simple verbs like \"add\" and \"getAll\".<br>\nThey dispatch actions that trigger asynchronous requests to a remote server.</p>\n<p>The cache-only command methods are longer verbs like \"addManyToCache\" and \"removeOneFromCache\"\nand their names all contain the word \"cache\".\nThey update the cached collection immediately (synchronously).</p>\n<blockquote>\n<p>Most applications call the server commands because they want to query and save entity data.</p>\n<p>Apps rarely call the cache-only commands because direct updates to the entity collection\nare lost when the application shuts down.</p>\n</blockquote>\n<p>Many <code><a href=\"api/data/EntityCollectionService\" class=\"code-anchor\">EntityCollectionService</a></code> command methods take a value.\nThe value is <em>typed</em> (often as <code>Hero</code>) so you won't make a mistake by passing in the wrong kind of value.</p>\n<p>Internally, an entity service method creates an\n<a href=\"guide/data/entity-actions\"><em>entity action</em></a> that corresponds to the method's intent. The action's <em>payload</em> is either the value passed to the method or an appropriate derivative of that value.</p>\n<p><em>Immutability</em> is a core principle of the <em>redux pattern</em>.\nSeveral of the command methods take an entity argument such as a <code>Hero</code>.\nAn entity argument <strong>must never be a cached entity object</strong>.\nIt can be a <em>copy</em> of a cached entity object and it often is.\nThe demo application always calls these command methods with copies of the entity data.</p>\n<blockquote>\n<p>The current <em>NgRx</em> libraries do not guard against mutation of the objects (or arrays of objects) in the store.\nA future <em>NgRx</em> <strong><em>freeze</em></strong> feature will provide such a guard in <em>development</em> builds.</p>\n</blockquote>\n<p>All <em>command methods</em> return <code>void</code>.\nA core principle of the <em>redux pattern</em> is that <em>commands</em> never return a value. They just <em>do things</em> that have side-effects.</p>\n<p>Rather than expect a result from the command,\nyou subscribe to a <em>selector$</em> property that reflects\nthe effects of the command. If the command did something you care about, a <em>selector$</em> property should be able to tell you about it.</p>\n<p><a id=\"entity-collection-service-factory\"></a></p>\n<h2 id=\"entityservicefactory\"><em>EntityServiceFactory</em><a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/data/entity-collection-service#entityservicefactory\"><i class=\"material-icons\">link</i></a></h2>\n<p>The <code>create&#x3C;T>()</code> method of the NgRx Data <code><a href=\"api/data/EntityCollectionServiceFactory\" class=\"code-anchor\">EntityCollectionServiceFactory</a></code> produces a new instance\nof the <code><a href=\"api/data/EntityCollectionServiceBase\" class=\"code-anchor\">EntityCollectionServiceBase</a>&#x3C;T></code> class that implements the <code><a href=\"api/data/EntityCollectionService\" class=\"code-anchor\">EntityCollectionService</a></code> interface for the entity type <code>T</code>.</p>\n\n</div>\n\n<!-- links to this doc:\n - guide/data/entity-services\n-->\n<!-- links from this doc:\n - api/data/EntityCollection#loading\n - api/data/EntityCollectionService\n - api/data/EntityCollectionServiceBase\n - api/data/EntityCollectionServiceFactory\n - api/data/EntityCommands\n - api/data/EntitySelectors$\n - guide/data/entity-actions\n - guide/data/entity-collection-service#call-command-methods\n - guide/data/entity-collection-service#create-the-entitycollectionservice-as-a-class\n - guide/data/entity-collection-service#create-the-entitycollectionservice-with-a-factory\n - guide/data/entity-collection-service#entity-collection-service-factory\n - guide/data/entity-collection-service#entitycollectionservice\n - guide/data/entity-collection-service#entityservicefactory\n - guide/data/entity-collection-service#examples-from-the-demo-app\n - guide/data/entity-collection-service#set-component-selector-properties\n - guide/data/entity-dataservice\n - https://github.com/ngrx/platform/edit/master/projects/ngrx.io/content/guide/data/entity-collection-service.md?message=docs%3A%20describe%20your%20change...\n-->"
}